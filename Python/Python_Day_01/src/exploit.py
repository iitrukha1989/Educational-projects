from bs4 import BeautifulSoup


def exploit():
    with open('evilcorp.html', encoding='utf-8') as html_file:
        soup_value = BeautifulSoup(html_file, 'html.parser')
        replace_title(soup_value)
        insert_tag(soup_value, 'h1', 'Mr. Alderson, you are hacked!')
        insert_script(soup_value)
        replace_link(
            soup_value, 'https://mrrobot.fandom.com/wiki/Fsociety', 'Fsociety')
        with open('evilcorp_hacked.html', 'w', encoding='utf-8') as html_value:
            html_value.write(str(soup_value.prettify()))


def replace_title(soup_value):
    soup_value.title.string.replace_with(
        "Evil Corp - Stealing your money every day")


def insert_tag(soup_value, tag_name, tag_text):
    new_div_value = soup_value.new_tag(tag_name)
    new_div_value.string = tag_text
    soup_value.html.body.insert(0, new_div_value)


def insert_script(soup_value):
    tag_value = soup_value.new_tag('script')
    tag_value.string = """hacked = function() {
                alert('hacked');
            }
            window.addEventListener('load',
            function() {
                var f = document.querySelector("form");
                f.setAttribute("onsubmit", "hacked()");
            },
            false
            );
        """
    soup_value.html.body.append(tag_value)


def replace_link(soup_value, link_value, link_text):
    tag_value = soup_value.a
    tag_value['href'] = link_value
    soup_value.a.string.replace_with(link_text)


def main():
    exploit()


if __name__ == '__main__':
    main()
